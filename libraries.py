#Imports
from flask import Flask, jsonify, request, abort, send_from_directory, url_for, redirect, Blueprint, make_response, Response, render_template, session, send_file
import random, math, operator
import re, base64
from datetime import datetime, timedelta, date as odate
import json, os, sys
try:
    # For Python 3.0 and later
    from urllib.request import urlopen
except ImportError:
    # Fall back to Python 2's urllib2
    from urllib2 import urlopen

import csv

import requests

import urllib

from flask_cors import CORS

from functools import wraps

import schedule
import time
from threading import Thread

import logging

from datetime import date, datetime, timedelta

from apscheduler.scheduler import Scheduler

SUMMARY_URL = "https://api.rootnet.in/covid19-in/stats/latest"
DAILY_URL = "https://api.rootnet.in/covid19-in/stats/daily"


# PATIENT_DATA_URL = "https://api.covid19india.org/raw_data.json"
PATIENT_DATA_URL = "https://raw.githubusercontent.com/covid19india/api/master/raw_data.json"

HISTORY_URL = "https://corona.lmao.ninja/v2/historical/india"

# NEW_SUMMARY_URL = "https://api.covid19india.org/data.json"
NEW_SUMMARY_URL = "https://raw.githubusercontent.com/covid19india/api/master/data.json"

ALL_COUNTRIES_CONFIRMED_URL = "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/\
csse_covid_19_time_series/time_series_covid19_confirmed_global.csv"

ALL_COUNTRIES_DEATHS_URL = "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/\
csse_covid_19_time_series/time_series_covid19_deaths_global.csv"

ALL_COUNTRIES_RECOVERED_URL = "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/\
csse_covid_19_time_series/time_series_covid19_recovered_global.csv"


WORLD_DATA_BASE_URL = "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/\
master/csse_covid_19_data/csse_covid_19_daily_reports/"

# ALL_STATES_URL = "https://api.covid19india.org/states_daily.json"
ALL_STATES_URL = "https://raw.githubusercontent.com/covid19india/api/master/states_daily.json"

TOP_COUNTRIES = ["US", "China", "Spain", "Italy", "India"]

POPULATION = {
"China": 1401855920,
"India": 1360053900,
"US": 329488021,
"Indonesia": 266911900,
"Pakistan": 219016520,
"Brazil": 211283757,
"Nigeria": 206139587,
"Bangladesh": 168304408,
"Russia": 146745098,
"Mexico": 126577691,
"Japan": 126010000,
"Philippines": 108433682,
"Egypt": 100150004,
"Ethiopia": 98665000,
"Vietnam": 96208984,
"Congo (Kinshasa)": 89561404,
"Iran": 83298325,
"Turkey": 83154997,
"Germany": 83149300,
"France": 67069000,
"Thailand": 66483955,
"United Kingdom": 66435600,
"Italy": 60243406,
"South Africa": 58775022,
"Tanzania": 55890747,
"Myanmar": 54339766,
"Korea, South": 51780579,
"Colombia": 49395678,
"Kenya": 47564296,
"Spain": 47100396,
"Argentina": 44938712,
"Algeria": 43000000,
"Sudan": 42361520,
"Ukraine": 41902416,
"Uganda": 40299300,
"Iraq": 39127900,
"Poland": 38386000,
"Canada": 37965057,
"Morocco": 35845131,
"Saudi Arabia": 34218169,
"Uzbekistan": 34081430,
"Malaysia": 32725760,
"Afghanistan": 32225560,
"Venezuela": 32219521,
"Peru": 32131400,
"Angola": 31127674,
"Ghana": 30280811,
"Mozambique": 30066648,
"Yemen": 29825968,
"Nepal": 29609623,
"Cameroon": 26545864,
"Cote d'Ivoire": 25823071,
"Madagascar": 25680342,
"Australia": 25652995,
"North Korea": 25450000,
"Taiwan*": 23604265,
"Niger": 22314743,
"Sri Lanka": 21803000,
"Burkina Faso": 20870060,
"Mali": 19973000,
"Romania": 19405156,
"Malawi": 19129952,
"Chile": 19107216,
"Kazakhstan": 18667080,
"Syria": 17500657,
"Ecuador": 17448612,
"Netherlands": 17446831,
"Zambia": 17381168,
"Guatemala": 16604026,
"Senegal": 16209125,
"Somalia": 15893219,
"Chad": 15692969,
"Cambodia": 15288489,
"Zimbabwe": 15159624,
"South Sudan": 12778250,
"Rwanda": 12374397,
"Guinea": 12218357,
"Benin": 11733059,
"Tunisia": 11722038,
"Haiti": 11577779,
"Belgium": 11524454,
"Bolivia": 11469896,
"Cuba": 11209628,
"Burundi": 10953317,
"Greece": 10724599,
"Czechia": 10693939,
"Jordan": 10640708,
"Dominican Republic": 10358320,
"Sweden": 10333456,
"Portugal": 10276617,
"Azerbaijan": 10067108,
"United Arab Emirates": 9890400,
"Hungary": 9772756,
"Belarus": 9413446,
"Israel": 9174600,
"Honduras": 9158345,
"Tajikistan": 9127000,
"Papua New Guinea": 8935000,
"Austria": 8902600,
"Switzerland": 8586550,
"Sierra Leone": 7901454,
"Togo": 7538000,
"Hong Kong": 7500700,
"Paraguay": 7152703,
"Laos": 7123205,
"Bulgaria": 7000039,
"Serbia": 6963764,
"Libya": 6871287,
"Lebanon": 6825442,
"Kyrgyzstan": 6523500,
"El Salvador": 6486201,
"Nicaragua": 6460411,
"Turkmenistan": 6031187,
"Denmark": 5822763,
"Singapore": 5703600,
"Finland": 5527573,
"Congo (Brazzaville)": 5518092,
"Central African Republic": 5496011,
"Slovakia": 5456362,
"Norway": 5367580,
"Costa Rica": 5058007,
"Palestine": 4976684,
"New Zealand": 4971963,
"Ireland": 4921500,
"Oman": 4664790,
"Liberia": 4475353,
"Kuwait": 4420110,
"Panama": 4218808,
"Mauritania": 4077347,
"Croatia": 4076246,
"Georgia": 3723464,
"Uruguay": 3518552,
"Eritrea": 3497117,
"Mongolia": 3308624,
"Bosnia and Herzegovina": 3301000,
"Puerto Rico": 3193694,
"Armenia": 2957500,
"Albania": 2862427,
"Lithuania": 2793471,
"Qatar": 2747282,
"Jamaica": 2726667,
"Moldova": 2681735,
"Namibia": 2458936,
"Gambia, The": 2347706,
"Botswana": 2338851,
"Gabon": 2172579,
"Slovenia": 2094060,
"North Macedonia": 2077132,
"Lesotho": 2007201,
"Latvia": 1906800,
"Kosovo": 1795666,
"Guinea-Bissau": 1604528,
"Bahrain": 1543300,
"East Timor": 1387149,
"Trinidad and Tobago": 1363985,
"Equatorial Guinea": 1358276,
"Estonia": 1328360,
"Mauritius": 1265985,
"Eswatini": 1093238,
"Djibouti": 1078373,
"Fiji": 884887,
"Cyprus": 875900,
"Comoros": 873724,
"Guyana": 782766,
"Bhutan": 741672,
"Solomon Islands": 680806,
"Macau": 679600,
"Montenegro": 622359,
"Luxembourg": 613894,
"Western Sahara": 582463,
"Suriname": 581372,
"Cape Verde": 550483,
"Malta": 493559,
"Transnistria": 469000,
"Brunei": 442400,
"Belize": 408487,
"Bahamas, The": 385340,
"Maldives": 374775,
"Iceland": 364260,
"Northern Cyprus": 351965,
"Vanuatu": 304500,
"Barbados": 287025,
"New Caledonia": 282200,
"French Polynesia": 275918,
"Abkhazia": 244832,
"Samoa": 200874,
"Saint Lucia": 178696,
"Guam": 172400,
"Artsakh": 148000,
"Kiribati": 120100,
"Aruba": 112309,
"Grenada": 112003,
"Saint Vincent and the Grenadines": 110608,
"Jersey": 106800,
"U.S. Virgin Islands": 104578,
"F.S. Micronesia": 104468,
"Tonga": 100651,
"Seychelles": 97625,
"Antigua and Barbuda": 96453,
"Isle of Man": 83314,
"Andorra": 77543,
"Dominica": 71808,
"Cayman Islands": 65813,
"Bermuda": 64027,
"Guernsey": 62792,
"American Samoa": 56700,
"Greenland": 56081,
"Northern Mariana Islands": 56200,
"Marshall Islands": 55500,
"South Ossetia": 53532,
"Saint Kitts and Nevis": 52823,
"Faroe Islands": 52124,
"Turks and Caicos Islands": 41369,
"Sint Maarten": 40614,
"Liechtenstein": 38749,
"Monaco": 38300,
"Saint Martin": 35746,
"Gibraltar": 33701,
"San Marino": 33574,
"British Virgin Islands": 30030,
"Palau": 17900,
"Cook Islands": 15200,
"Anguilla": 14869,
"Wallis and Futuna": 11700,
"Nauru": 11000,
"Tuvalu": 10200,
"Saint Pierre and Miquelon": 6008,
"Montserrat": 4989,
"Falkland Islands": 3198,
"Christmas Island": 1928,
"Norfolk Island": 1756,
"Niue": 1520,
"Tokelau": 1400,
"Holy See": 799,
"Cocos (Keeling) Islands": 538,
"Pitcairn Islands": 50,
"Martinique": 376480,
"Cruise Ship": 3711
}


INDIAN_STATES = {
"an": "Andaman and Nicobar Islands",
"ap": "Andhra Pradesh",
"ar": "Arunachal Pradesh",
"as": "Assam",
"br": "Bihar",
"ch": "Chandigarh",
"ct": "Chattisgarh",
"dd": "Daman and Diu",
"dl": "Delhi",
"dn": "Dadra and Nagar Haveli",
"ga": "Goa",
"gj": "Gujarat",
"hp": "Himachal Pradesh",
"hr": "Haryana",
"jh": "Jharkhand",
"jk": "Jammu and Kashmir",
"ka": "Karnataka",
"kl": "Kerala",
"la": "Ladakh",
"ld": "Lakshadweep",
"mh": "Maharashtra",
"ml": "Meghalaya",
"mn": "Manipur",
"mp": "Madhya Pradesh",
"mz": "Mizoram",
"nl": "Nagaland",
"or": "Odisha",
"pb": "Punjab",
"py": "Puducherry",
"rj": "Rajasthan",
"sk": "Sikkim",
"tg": "Telangana",
"tn": "Tamil Nadu",
"tr": "Tripura",
"up": "Uttar Pradesh",
"ut": "Uttarakhand",
"wb": "West Bengal"
}

INDIAN_STATES_POPULATION = {
"Uttar Pradesh" : "199581477",
"Maharashtra" : "112372972",
"Bihar" : "103804630",
"West Bengal" :	"91347736",
"Madhya Pradesh" : "72597565",
"Tamil Nadu" : "72138958",
"Rajasthan" : "68621012",
"Karnataka" : "61130704",
"Gujarat" : "60383628",
"Andhra Pradesh" :	"84580777",
"Odisha" : "41947358",
"Telangana" : "35193978",
"Kerala" : "33387677",
"Jharkhand" : "32988134",
"Assam" : "31169272",
"Punjab" : "27704236",
"Haryana" : "25753081",
"Chattisgarh" : "25540196",
"Jammu and Kashmir" : "12548926",
"Ladakh": "274926",
"Uttarakhand" : "10116752",
"Himachal Pradesh" : "6856509",
"Tripura" : "3671032",
"Meghalaya" : "2964007",
"Manipur" : "2721756",
"Nagaland" : "1980602",
"Goa" : "1457723",
"Arunachal Pradesh" : "1382611",
"Mizoram" : "1091014",
"Sikkim" : "607688",
"Delhi" : "16753235",
"Puducherry" : 	"1244464",
"Chandigarh" : 	"1054686",
"Andaman and Nicobar Islands":	"379944",
"Dadra and Nagar Haveli" :	"342853",
"Daman and Diu" : "242911",
"Lakshadweep" : "64429"
}